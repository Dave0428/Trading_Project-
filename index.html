<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prop Firm Trading Dashboard</title>

<link rel="manifest" href="manifest.json">

<style>
body {
  margin: 0;
  background: #0b132b;
  font-family: 'Segoe UI', sans-serif;
  color: white;
  display: flex;
  justify-content: center;
  padding: 16px;
}

.app {
  width: 390px;
  background: #1c2541;
  border-radius: 22px;
  padding: 18px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
}

h1 {
  text-align: center;
  margin-bottom: 6px;
}

.section {
  background: #3a506b;
  border-radius: 16px;
  padding: 12px;
  margin: 12px 0;
}

.warning {
  background: #e63946;
  padding: 10px;
  border-radius: 12px;
  font-size: 13px;
  text-align: center;
}

button {
  width: 100%;
  padding: 10px;
  border-radius: 20px;
  border: none;
  background: #5bc0be;
  font-weight: bold;
  cursor: pointer;
}

input, select, textarea {
  width: 100%;
  padding: 8px;
  border-radius: 10px;
  border: none;
  margin-top: 6px;
}

.trade {
  font-size: 13px;
  margin-bottom: 8px;
}
</style>
</head>

<body>

<div class="app">
<h1>ğŸ¦ Prop Firm Journal</h1>
<p style="text-align:center;font-size:13px;">
Discipline > Profit
</p>

<div class="section">
<h2>ğŸ“Š Performance</h2>
<div id="stats"></div>
</div>

<div class="section">
<h2>â• Log Trade</h2>

<select id="session">
<option>Asia</option>
<option>London</option>
<option>New York</option>
</select>

<select id="result">
<option value="win">WIN</option>
<option value="loss">LOSS</option>
</select>

<input id="pair" value="XAUUSD">

<textarea id="notes" rows="2" placeholder="Setup / Mistake / Rule check"></textarea>

<button onclick="addTrade()">Submit Trade</button>
</div>

<div class="section">
<h2>ğŸš¨ Risk Monitor</h2>
<div id="warnings"></div>
</div>

<div class="section">
<h2>ğŸ“‹ Trade Log</h2>
<div id="history"></div>
</div>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

let trades = JSON.parse(localStorage.getItem("propTrades")) || [];

function addTrade() {
  const trade = {
    session: session.value,
    result: result.value,
    pair: pair.value,
    notes: notes.value,
    time: new Date().toLocaleString()
  };

  trades.push(trade);
  localStorage.setItem("propTrades", JSON.stringify(trades));
  render();
}

function render() {
  let wins = trades.filter(t=>t.result==="win").length;
  let losses = trades.filter(t=>t.result==="loss").length;

  stats.innerHTML = `
    Trades: ${trades.length}<br>
    Wins: ${wins}<br>
    Losses: ${losses}<br>
    Win Rate: ${trades.length ? Math.round((wins/trades.length)*100) : 0}%
  `;

  checkRules();

  history.innerHTML = "";
  trades.slice().reverse().forEach(t=>{
    history.innerHTML += `
      <div class="trade">
      <b>${t.result.toUpperCase()}</b> â€“ ${t.pair} (${t.session})<br>
      ${t.notes}<br>
      <small>${t.time}</small>
      <hr>
      </div>
    `;
  });
}

function checkRules() {
  let warn = "";

  const today = new Date().toDateString();
  const todayTrades = trades.filter(t =>
    new Date(t.time).toDateString() === today
  );

  if (todayTrades.length > 2) {
    warn += "âŒ Overtrading detected (Max 2 trades/day)<br>";
  }

  const last3 = trades.slice(-3);
  if (last3.filter(t=>t.result==="loss").length === 3) {
    warn += "âš ï¸ 3-loss streak. STOP trading.<br>";
  }

  warnings.innerHTML = warn
    ? `<div class="warning">${warn}</div>`
    : "âœ… Rules respected";
}

render();
</script>

</body>
</html>